Wallet
===

The Fuel wallet library is used for handling more complex transactional situations such as swapping, multi-output transactions, local input database handling, hash time lock contracts etc.

The wallet defaults to a memdown database but other down DB's can be used such as an Index DB or local storage.

Install
---

```bash
npm install --save @fuel-js/wallet
```

Usage
---

```js
import fuel from '@fuel-js/wallet';

// specify the web3 or ethers provider, if you don't have a signer, use `key` to override

const wallet = new fuel.Wallet(window.web3.currentProvider, {
  // key: fuel.utils.randomBytes(32), // or new fuel.utils.SigningKey(...),
  // gasPrice: ..., // default gas price for Ethereum related activities
  // gasLimit: ..., // default gas price for Ethereum related activities
  // from: '0x...', // default address for Ethereum or read-only watching
  // db: require('level-js')(), // a level compliant database
});
```

Deposit Funds
---

```js
  await wallet.deposit(daiAddress, 500000, {
    // gasPrice: ...,
    // gasLimit: ...,
    // from: '0x...',
    // timeout: 10000, // seconds
  });
```

Make a Transfer
---

```js
  await wallet.transfer(daiAddress, someAddress, 250000, {
    // inputs: [], // specify explicit array of utxo hashes to spend
    // feeLimit: 2000,
    // from: '0x....',
    // gasPrice: ..., // only used if forcing a tx
    // gasLimit: ..., // only used if forcing a tx
    // force: true, // will attempt for force tx on-chain
  });
```

Instant Withdrawals
---

```js
  await wallet.withdraw(daiAddress, 250000, {
    instant: true,
    liquidityFee: 2000,
    // inputs: [], // specify explicit array of utxo hashes to spend
    // feeLimit: 2000,
    // from: '0x....',
    // gasPrice: ..., // only used if forcing a tx
    // gasLimit: ..., // only used if forcing a tx
    // force: true, // will attempt for force tx on-chain
  });
```

Long Withdrawals
---

```js
  await wallet.withdraw(daiAddress, 250000, {
    // inputs: [], // specify explicit array of utxo hashes to spend
    // feeLimit: 2000,
    // from: '0x....',
    // gasPrice: ..., // only used if forcing a tx
    // gasLimit: ..., // only used if forcing a tx
    // force: true, // will attempt for force tx on-chain
  });

  // after 2 weeks...
  await wallet.retrive({
    // inputs: [], // specify explicit array of utxo hashes to retrieve
    // from: '0x....',
    // gasPrice: ..., // only used if forcing a tx
    // gasLimit: ..., // only used if forcing a tx
  });
```

Swap
---

```js
  await wallet.swap(daiAddress, usdcAddress, 250000, {
    slippage: 2.3, // 2.3 percent
    // inputs: [], // specify explicit array of utxo hashes to swap
    // list: '0x....', // the liquidity provider list
    // feeLimit: 2000,
    // from: '0x....',
    // gasPrice: ..., // only used if forcing a tx
    // gasLimit: ..., // only used if forcing a tx
    // force: true, // will attempt for force tx on-chain
  });
```

HTLC
---

```js
  const digest = fuel.utils.keccak256('0xbeef');
  const expiry = 500; // in ethereum blocks

  await wallet.htlc(daiAddress, 250000, digest, expiry, {
    // inputs: [], // specify explicit array of utxo hashes to swap
    // feeLimit: 2000,
    // from: '0x....',
    // gasPrice: ..., // only used if forcing a tx
    // gasLimit: ..., // only used if forcing a tx
    // force: true, // will attempt for force tx on-chain
  });
```

Spending an HTLC
---

```js
  // now lets retrieve that HTLC by registering the necessary pre-image and sending to our own wallet
  await wallet.transfer(wallet.address, 250000, {
    preImages: ['0xbeef'],
  });
```

Batch Transactions
---

```js
  // send up to 8 output transactions
  await wallet.batch([
    { type: 'transfer', to: someAddress, value: 250000, token: daiAddress },
    { type: 'htlc', to: someAddress, value: 250000, token: daiAddress, digest: '0x...' },
    { type: 'transfer', to: otherAddres, value: 500, token: usdcAddress },
    { type: 'transfer', to: otherAddres, value: 10000, token: usdcAddress },
    { type: 'transfer', to: someAddress, value: 4000000, token: fuel.ether }, // send ether
  ], {
    // inputs: [], // specify explicit array of utxo hashes to swap
    // feeLimit: 2000,
    // from: '0x....',
    // gasPrice: ..., // only used if forcing a tx
    // gasLimit: ..., // only used if forcing a tx
    // force: true, // will attempt for force tx on-chain
  });
```

Sync
---

```js
  // sync your wallet with the Fuel api
  await wallet.sync();
```

Listen
---

```js
  // this will activate live input updates pubsub for your wallet or read-only address
  await wallet.listen();

  // now anytime the wallet receives funds, or sends funds this method will be called
  wallet.on('in', () => {});
  wallet.on('out', () => {});
```

Fee
---

```js
  // get the current Fee for processing a specific token
  await wallet.fee(daiAddress);
```

Token ID
---

```js
  // get the token ID of a token address, throw if none found
  await wallet.tokenId(daiAddress);
```

Commit Address
---

```js
  // commit your address for a cheaper tx for those sending to you
  await wallet.commit({
    // gasPrice: ...,
    // gasLimit: ...,
    // from: '0x...',
  });
```
