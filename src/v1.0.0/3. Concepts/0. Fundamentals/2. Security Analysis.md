Security Analysis
===

- [Common Definitions](#common-definitions)
    - [Desiderata](#desiderata)
- [Channels](#channels)
    - [Channel Networks](#channel-networks)
- [Sidechains](#sidechains)
- [Plasma](#plasma)
    - [Plasma MVP](#plasma-mvp)
    - [Plasma Cash](#plasma-cash)
    - [Validium](#validium)
- [Rollups](#rollups)
    - [ZK Rollups](#zk-rollups)
    - [Optimistic Rollups](#optimistic-rollups)
        - [Interactive Verification Games](#interactive-verification-games)

This page will provide a comprehensive overview of the security and scalability properties of Fuel as it compares to other so-called "scaling solutions." It argues that Fuel is uniquely positioned in the trade-off space to be the best scaling architecture today.

Common Definitions
---

We must first begin by establishing common definitions for desirable properties in a scaling solution. The following definitions are informal, but sufficiently precise to enable proper discussion on the matter. Note that they apply to both "layer-2" constructions as well as base "layer-1" blockchains.

**Security** Security can be roughly defined as the cost to manipulate history. Example: the security of Proof-of-Work blockchains can be measured as the capex and opex of producing new blocks. The security of Proof-of-Stake blockchains can be measured [as the penalty that can be applied](https://medium.com/@ercwl/proof-of-stake-is-less-wasteful-b2854a191766) if a history re-organization is done.

**Trustless** Trustlessness has two components: [_state liveness_ and _state safety_](https://arxiv.org/abs/1904.06441). State is live if it can be consumed by its owner in finite time (in other words, it cannot be burned/locked forever), and safe if it cannot be consumed by its non-owners ever (in other words, it cannot be stolen). It is critical to evaluate the trustlessness of a system across both these dimensions, not only state safety.

Decentralized blockchains cannot be completely trustless; to illustrate, consider that 51% of miners in a Proof-of-Work blockchain could censor any future transaction (effectively burning censored funds, which allows for [indirect theft](https://ethresear.ch/t/trustless-validator-blackmailing-with-the-blockchain/6922)) or even re-organize the history from genesis to steal all funds. Therefore we measure trustlessness as _the assumptions under which_ a system is trustless. As an example, if we assume 51% of miners are honest, then a blockchain is trustless. We can describe a system that is almost trustless as another as **trust-minimized** with respect to the other (e.g. a trust-minimized sidechain is trustless under almost the same assumptions as its main chain).

**Permissionless** A system is permissionless if it requires no permission _from inside the system_ to begin participating. It is permissioned otherwise.

**Decentralization** While commonly (and incorrectly) described as "the number of nodes," decentralization is measured as [the cost to run a fully validating node](https://www.truthcoin.info/blog/measuring-decentralization/). While permissionlessness is a necessary property for decentralization, it does not otherwise provide a metric for measuring decentralization. _Note:_ this definition is actually [missing a very important detail](#zk-rollups), but will suffice for now.

**Scalability and Throughput** Often a point of contention an confusion, scalability is front-and-center as the most obvious problem for contemporary blockchains. First, _throughput_ is the total transaction throughput of the system, measured in transactions per second. This is often the metric incorrectly advertized as scalability. _Scalability_ is the ratio of total transaction throughput to cost of running a node. Therefore, comparing transactions per second between two systems without simultaneously comparing their costs is comparing apples to oranges. It is trivial to increase throughput by simply increasing the cost to run a node, but that is not an increase to scalability.

> **Note:** While the _naming_ of the above properties may certainly be debated, that they are desirable properties in any scaling solution, and good metrics for evaluating such solutions, cannot.

### Desiderata

In order to be a "good" layer-2 scaling solution, we desire the following properties _simultaneously_:
1. The system must have equal or almost-equal security to the main chain. Non-trivial trade-offs in security are unacceptable from a scaling solution.
1. The system must be trust-minimized. Adding meaningful trust assumptions, similar to reducing security, is unacceptable.
1. The system should be permissionless. This is not a hard requirement, so long as the system is trustless, but it highly desired.
1. The system must have higher throughput than the main chain.
1. The system should be more scalable than the main chain. In the context of decentralization (cost of running a full node): the marginal cost of each layer-2 transaction must be lower than the marginal cost the same transaction at layer-1.
1. Additional desiderata include:
    - No need for hot keys
    - Backups support
    - No novel cryptography
    - Capital efficient
    - Low latency
    - Generalizability/expressivity

Lastly, similar decentralization to Ethereum: running a node for the layer-2 must not be more expensive than running a full node for Ethereum. Note that this is a deployment parameter, and is not intrinsic to any of the schemes discussed here. To have a proper basis for comparison, we want to be able to handle more transactions in our layer-2 than layer-1 Ethereum (with the same or similar trust assumptions), with the same hardware.

Put another way, everyone who could ever be interested in a particular interaction must fully validate that interaction (trust-minimization). If a layer-2 interaction is cheaper to validate than it would have been to validate on layer-1, then the layer-2 system provides scalability. If there are trustless guarantees that a particular interaction does not need to be validated by all users, then this can increase total transaction throughput without proportionally increasing full node costs (i.e. _unconditional scalability_). If there are no guarantees of this, then there may be _conditional scalability_, usually by deploying multiple instances of a scaling scheme with different participants.

Channels
---

Channels are one of the earliest blockchain scaling proposals. Originally taking the form of [payment channels](https://en.bitcoin.it/wiki/Payment_channels), they can be extended to arbitrary computation with [state channels](https://www.jeffcoleman.ca/state-channels).

A fixed set of participants can open a channel with a on-chain transaction that defines the rules of the channel. Updates to the channel state are made by unanimous consent: all participants signing a state update, communicated off-chain. Any participant may attempt to close the channel on a particular state, which starts a timeout during which anyone may submit a later state to penalize a fraudulent channel close attempt. If no later state has been shown by the timeout, the channel closes, settling balances based on the closing state.

Metrics:
1. Same security as the main chain.
1. Additional trust assumption: if the majority of miners censor transactions (which requires attacking the main chain), a proof of fraudulent channel close attempt can be censored, allowing theft of funds. Miners can already indirectly steal funds through censorship of the main chain, so this is not a meaningfully stronger trust assumption.
1. It is permissionless to open a channel, but participation in any specific channel is permissioned and fixed. This means e.g. [Uniswap](https://uniswap.org) cannot be implemented using only channels.
1. The total aggregate throughput can be substantially increased by using channels.
1. For a single channel, scalability depends on the execution model used, but it will usually be much cheaper to execute a transaction in a channel than it would be to validate it on Ethereum. For multiple channels, there is conditional scalability if the sets of participants is disjoint, which is usually the case since open-participation systems cannot be built with channels in the first place.
1. Additional concerns:
    - Hot keys are required to take advantage of the low latency of channels.
    - Backups are not possible, only copies (backups can recover everything but a delta, while copies are all-or-nothing). Only the latest channel state is useful, and in fact old channel states are worse-than-useless as attempting to close the channel with an old state will result in a penalty. Private key backups are insufficient to ensure funds cannot be lost.
    - Capital inefficient: funds must be locked up inside a channel before being used, and cannot be unlocked quickly without cooperation from the specific channel participants.
    - Instant finality: as soon as a state update is signed unanimously, it is instantly finalized.
    - Generalizable to contracts between a fixed participant set.

In summary, while trust-minimized, channels make enormous sacrifices in terms of capital efficiency, user experience, and open participation to achieve instant finality, which is a feature not possible with blockchains. As such, unless instant finality is a critical requirement, channels are unsuitable as a scaling solution.

### Channel Networks

[Channel networks](https://en.bitcoin.it/wiki/Lightning_Network) link together multiple channels with atomic multi-channel interactions. This allows for interactions between distinct channels, but do not allow open participation on a shared state (i.e. [Uniswap](https://uniswap.org) cannot be implemented using a channel network). They are unreliable unless an overwhelming majority of channel network participants are online simultaneously, which facilitates [a](https://arxiv.org/abs/2006.01418) [number](https://arxiv.org/abs/2006.08513) [of](https://arxiv.org/abs/2003.12470) [attacks](https://arxiv.org/abs/1904.10253).

In summary, channel networks do not diverge meaningfully from channels in the trade-off space.

Sidechains
---

[Sidechains](https://blockstream.com/sidechains.pdf) are blockchains the fully validate another blockchain as part of their consensus rules (e.g. a sidechain to Ethereum is a blockchain that validates the Ethereum chain). There are a number of ways sidechain blocks can be produced, including Proof-of-Authority (PoA, a single block producer), a federation, Nakomoto Consensus with Proof-of-Work (PoW), or even a consensus protocol using Proof-of-Stake (PoS) for Sybil resistance.

The _two-way peg_ design of the sidechain (i.e. the mechanism for locking tokens for use in the sidechain, then unlocking them back to the main chain) is critical. A trust-minimized two-way peg is ideal, but is not feasible with plain sidechains.

Metrics:
1. Sidechains _can_ have the same security as the main chain by timestamping sidechain block header hashes on the main chain.
1. A trust-minimized two-way peg is not possible with plain sidechains, since data withholding [is not a uniquely attributable fault](https://github.com/ethereum/research/wiki/A-note-on-data-availability-and-erasure-coding). A sidechain that adds features to make its two-way peg trust-minimized ends up becoming a [Plasma](#plasma) or a [rollup](#rollups).
1. Due to data withholding, sidechains degenerate to being permissioned: a cabal of sidechain block producers can create a block that other sidechain block producers can never build upon.
1. Any number of sidechains may be deployed in parallel, so throughput can be greatly increased.
1. Sidechains may have any execution model. As such, they can have a different—and more scalable—execution model than the main chain.
1. Additional concerns:
    - Sidechains are flexible: they can be faster, cheaper, and more expressive than the main chain.

In summary, plain sidechains have a number of nice features, namely their flexibility, but are not trust-minimized. As such, they are unsuitable as a scaling solution.

Plasma
---

[Plasma](https://plasma.io/plasma.pdf) is a scheme for trust-minimized but permissioned sidechains with exponentially lower on-chain costs. This requires transaction data to be kept entirely off-chain. Different flavors of Plasma (described below) have some common elements. Each Plasma block header is submitted by an _operator_ to a contract on Ethereum (which means Plasma has at least as high a latency as Ethereum). Withdrawals from the Plasma chain (i.e. _exits_) are involved, and are what allows for (in theory) a trust-minimized two-way peg.

All Plasma variants are permissioned, or degenerate to become permissioned. Even if more than a single operator is used (e.g. using some PoS protocol for Plasma block production) a cabal of operators can produce a block and withhold data, preventing other operators from ever building upon it. In fact, using PoS for Plasma block production is actively detrimental and worse-than-useless, as it adds friction and cost to end users without actually providing any of the nice properties of PoS-based consensus protocols. This is because [we cannot recover from PoS consensus failures without hard forks](https://ethresear.ch/t/against-proof-of-stake-for-zk-op-rollup-leader-election/7698), and it is impossible to trustlessly upgrade a smart contract.

This scaling scheme [has mostly been abandoned](https://medium.com/dragonfly-research/the-life-and-death-of-plasma-b72c6a59c5ad) in favor of [rollups](#rollups) for additional reasons that will become apparent soon.

### Plasma MVP

[Plasma MVP](https://ethresear.ch/t/minimal-viable-plasma/426) variants were the first concrete flavor of Plasma. A Plasma operator aggregates transactions off-chain, then commits to them in a Plasma block header that is processed on-chain. The UTXO data model is used, but the accounts data model can be used just as well. Exits are initiated against any previous block. If an exit is invalid (e.g. trying to exit a spent coin), a fraud proof can cancel it, otherwise the exit is placed in a priority queue based on Plasma block number. After a timeout, the exit can be completed and funds withdrawn from the contract.

However, since block data can be withheld, the operator can create an invalid Plasma block that gives them all funds, then exit them. Block data is unavailable, so no one can prove the exit is fraudulent. Therefore all users must exit from the Plasma _before_ the timeout expires by exiting their funds from an earlier (available) Plasma block than the malicious operator's exit. This is called a [mass exit](https://ethresear.ch/t/basic-mass-exits-for-plasma-mvp/3316), an involves putting the Plasma chain's entire _state_ onto Ethereum in a short amount of time.

Metrics:
1. Security is borrowed from the main chain, as Plasma blocks are timestamped by Ethereum.
1. Plasma MVP variants are only trust-minimized in theory. In practice, mass exits allow an adversary to start an attack with constant cost (posting a single invalid Plasma block header on-chain) that requires unbounded cost to defend (users must exit the entire state in a short time, and state is essentially unbounded in size). Therefore Plasma MVP variants degenerate in practice to sidechains.
1. Plasma MVP is a Plasma and thus permissioned.
1. Plasma MVP may have higher

In summary,

### Plasma Cash

https://ethresear.ch/t/plasma-cash-plasma-with-much-less-per-user-data-checking/1298

two challenges
https://www.gakonst.com/plasmacash.pdf

https://ethresear.ch/t/watchtowers-may-not-work-in-plasma-cash/1968

### Validium

[Lower Bounds for Off-Chain Protocols: Exploring the Limits of Plasma](https://eprint.iacr.org/2020/175)

Rollups
---

https://medium.com/@adlerjohn/the-why-s-of-optimistic-rollup-7c6a22cbb61a

https://ethresear.ch/t/against-proof-of-stake-for-zk-op-rollup-leader-election/7698

https://ethresear.ch/t/spam-resistant-block-creator-selection-via-burn-auction/5851

https://github.com/ethereum/research/blob/master/papers/pricing/ethpricing.pdf

latency

### ZK Rollups

https://github.com/barryWhiteHat/roll_up

https://ethresear.ch/t/on-chain-scaling-to-potentially-500-tx-sec-through-mass-tx-validation/3477

https://ethresear.ch/t/trustless-two-way-bridges-with-side-chains-by-halting/5728

### Optimistic Rollups

https://ethresear.ch/t/minimal-viable-merged-consensus/5617

#### Interactive Verification Games

https://www.usenix.org/system/files/conference/usenixsecurity18/sec18-kalodner.pdf
